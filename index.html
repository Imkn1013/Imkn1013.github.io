<script>
  const socket = io("https://conscious-giddy-antarctopelta.glitch.me");
  let data = { room: null }; // ルーム情報を格納

  socket.on("connect", () => {
    console.log("Connected to the server");
  });

  document.getElementById("mkroom").addEventListener("click", function () {
    const roomid = document.getElementById("roomidarea").value.trim();
    if (roomid === "") {
      console.log("ルームIDを入力してください");
      return;
    }
    socket.emit("joinRoom", roomid);
    data.room = roomid; // 現在のルームを記録
    console.log(`${roomid}に参加しました。`);
  });

  document.getElementById("sendmessage").addEventListener("click", function () {
    const message = document.getElementById("messagearea").value.trim();
    if (data.room) {
      if (message === "") {
        console.log("メッセージを入力してください");
        return;
      }
      socket.emit("sendMessageToRoom", { room: data.room, message });
    } else {
      console.log("ルームに入っていません。");
    }
  });

  socket.on("roomMessage", (data) => {
    console.log(`${data.room}: ${data.message}`);
  });

  socket.on("roomMembers", ({ room, members }) => {
    const memberList = document.getElementById("memberList");
    memberList.innerHTML = "";
    members.forEach((member) => {
      const listItem = document.createElement("li");
      listItem.textContent = member;
      memberList.appendChild(listItem);
    });
  });

  socket.on("errorMessage", (message) => {
    alert(message);
  });

  document.getElementById("leaveRoom").addEventListener("click", function () {
    if (data.room) {
      console.log(`${data.room}から退出しました。`);
      socket.emit("leaveRoom");
      data.room = null; // 現在のルーム情報をクリア
      document.getElementById("memberList").innerHTML = "";
      document.getElementById("chatlist").innerHTML = "";
    } else {
      console.log("退出するルームがありません。");
    }
  });
</script>
